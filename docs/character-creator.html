<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DewDrops - Character Creator</title>
    <link rel="stylesheet" href="styles.css"> 
</head>
<body>

    <header>
        <h1>Character Creator</h1>
        <p>Forge your hero for the world of DewDrops.</p>
    </header>
    
    <nav>
        <a href="index.html">Back to Core Rules</a>
    </nav>

    <main>
        <form id="character-form">
            <label for="char-name">Character Name:</label><br>
            <input type="text" id="char-name" required><br><br>
            
            <label for="char-race">Race/Clan:</label><br>
            <input type="text" id="char-race"><br><br>
    
            <h3>Attributes (Start with 10 points to distribute)</h3>
            <label for="fort">FORTITUDE (FORT):</label>
            <input type="number" id="fort" value="1" min="1"><br>
    
            <label for="agi">AGILITY (AGI):</label>
            <input type="number" id="agi" value="1" min="1"><br>
    
            <label for="int">INTELLIGENCE (INT):</label>
            <input type="number" id="int" value="1" min="1"><br>
    
            <label for="wits">WITS:</label>
            <input type="number" id="wits" value="1" min="1"><br>
    
            <label for="magic">MAGIC:</label>
            <input type="number" id="magic" value="1" min="1"><br><br>
    
            <button type="submit">Save Character</button>
        </form>
    
        <p id="feedback-message"></p>
    </main>

    <script type="module">
        // 1. IMPORT THE DATABASE CONNECTION
        // The path '../src/firebase-init.js' points from your /docs folder back to the root and then into /src.
        // This path is crucial and must be correct for it to work.
        import { db } from '../src/firebase-init.js'; 
        
        // 2. IMPORT FIRESTORE FUNCTIONS
        // These are the tools from the Firebase SDK that let us talk to the database.
        import { collection, addDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        // 3. GET THE HTML ELEMENTS
        const characterForm = document.getElementById('character-form');
        const feedbackMessage = document.getElementById('feedback-message');

        // 4. LISTEN FOR THE FORM SUBMIT EVENT
        characterForm.addEventListener('submit', async (e) => {
            e.preventDefault(); // This stops the page from reloading on submit

            feedbackMessage.textContent = 'Saving...'; // Give the user instant feedback

            // 5. GATHER THE DATA FROM THE FORM INTO AN OBJECT
            const characterData = {
                name: document.getElementById('char-name').value,
                race: document.getElementById('char-race').value,
                attributes: {
                    FORT: parseInt(document.getElementById('fort').value),
                    AGI: parseInt(document.getElementById('agi').value),
                    INT: parseInt(document.getElementById('int').value),
                    WITS: parseInt(document.getElementById('wits').value),
                    MAGIC: parseInt(document.getElementById('magic').value)
                },
                createdAt: new Date() // Always good to have a timestamp
            };

            // 6. SAVE THE DATA TO FIRESTORE
            try {
                // The 'addDoc' function adds a new document to the "characters" collection
                const docRef = await addDoc(collection(db, "characters"), characterData);
                console.log("Document written with ID: ", docRef.id);
                feedbackMessage.textContent = `Character "${characterData.name}" was saved successfully!`;
                characterForm.reset(); // Clear the form for the next character
            } catch (error) {
                console.error("Error adding document: ", error);
                feedbackMessage.textContent = "There was an error saving your character.";
            }
        });
    </script>

</body>
</html>
